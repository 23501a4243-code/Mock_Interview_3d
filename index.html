<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CareerCatalyst - AI-Powered Career Platform</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Global Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            min-height: 100vh;
            padding: 20px;
        }

        .page {
            display: none;
            max-width: 1200px;
            margin: 0 auto;
            animation: fadeIn 0.5s ease-in-out;
        }

        .active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Login Page Styles */
        .login-container {
            display: flex;
            max-width: 1000px;
            width: 100%;
            background: white;
            border-radius: 20px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
            overflow: hidden;
            margin: 50px auto;
            transition: transform 0.3s ease;
        }

        .login-container:hover {
            transform: translateY(-5px);
        }

        .brand-section {
            flex: 1;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 60px 40px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .brand-section::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0) 70%);
            animation: float 6s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(180deg); }
        }

        .brand-section h1 {
            font-size: 3.5rem;
            margin-bottom: 15px;
            font-weight: 800;
            text-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }

        .brand-section p {
            font-size: 1.3rem;
            opacity: 0.9;
            line-height: 1.6;
            margin-bottom: 30px;
        }

        .features {
            text-align: left;
            margin-top: 40px;
        }

        .feature {
            display: flex;
            align-items: center;
            margin-bottom: 25px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            transition: transform 0.3s ease;
        }

        .feature:hover {
            transform: translateX(10px);
        }

        .feature i {
            font-size: 1.5rem;
            margin-right: 15px;
            background: rgba(255, 255, 255, 0.2);
            padding: 12px;
            border-radius: 50%;
        }

        .form-section {
            flex: 1;
            padding: 60px 40px;
            background: #fff;
        }

        .form-tabs {
            display: flex;
            margin-bottom: 30px;
            border-bottom: 1px solid #e1e1e1;
        }

        .form-tab {
            padding: 12px 25px;
            cursor: pointer;
            font-weight: 600;
            color: #666;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
        }

        .form-tab.active {
            color: #667eea;
            border-bottom: 3px solid #667eea;
        }

        .form-tab:hover {
            color: #667eea;
        }

        .form-content {
            display: none;
        }

        .form-content.active {
            display: block;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 600;
        }

        .input-with-icon {
            position: relative;
        }

        .input-with-icon i {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #667eea;
        }

        .input-with-icon input, .input-with-icon select {
            width: 100%;
            padding: 15px 15px 15px 45px;
            border: 2px solid #e1e1e1;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .input-with-icon input:focus, .input-with-icon select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .remember-forgot {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .remember-me {
            display: flex;
            align-items: center;
        }

        .remember-me input {
            margin-right: 8px;
        }

        .forgot-password {
            color: #667eea;
            text-decoration: none;
            font-weight: 600;
        }

        .forgot-password:hover {
            text-decoration: underline;
        }

        .submit-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .submit-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.5s;
        }

        .submit-btn:hover::before {
            left: 100%;
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        /* Dashboard Styles */
        .dashboard-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
            overflow: hidden;
            min-height: 80vh;
        }

        .dashboard-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            position: relative;
            overflow: hidden;
        }

        .dashboard-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" width="100" height="100" opacity="0.1"><circle cx="50" cy="50" r="2" fill="white"/></svg>');
        }

        .user-welcome {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            position: relative;
        }

        .user-welcome h1 {
            font-size: 2.5rem;
            text-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }

        .logout-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 12px 25px;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .logout-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .dashboard-content {
            padding: 40px;
        }

        /* Stats Section */
        .stats-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            text-align: center;
            transition: transform 0.3s ease;
            border-left: 4px solid #667eea;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-card i {
            font-size: 2.5rem;
            color: #667eea;
            margin-bottom: 15px;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: #333;
            margin: 10px 0;
        }

        .stat-label {
            color: #666;
            font-size: 0.9rem;
        }

        /* Upload Section */
        .upload-section {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            border: 2px dashed #667eea;
            transition: all 0.3s ease;
        }

        .upload-section:hover {
            border-color: #764ba2;
            transform: translateY(-2px);
        }

        .upload-area {
            border: 2px dashed #667eea;
            border-radius: 10px;
            padding: 40px;
            text-align: center;
            margin: 20px 0;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
        }

        .upload-area:hover {
            background: #f8f9fa;
            border-color: #764ba2;
        }

        .upload-area i {
            font-size: 3rem;
            color: #667eea;
            margin-bottom: 15px;
        }

        .upload-area p {
            color: #666;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        .upload-area small {
            color: #999;
        }

        .file-input {
            display: none;
        }

        .job-description {
            margin-top: 30px;
        }

        .job-description textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #e1e1e1;
            border-radius: 10px;
            font-size: 1rem;
            min-height: 150px;
            resize: vertical;
            transition: all 0.3s ease;
        }

        .job-description textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .schedule-section {
            margin-top: 40px;
        }

        .calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
            margin-top: 20px;
        }

        .calendar-header {
            text-align: center;
            font-weight: 600;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 5px;
        }

        .calendar-day {
            text-align: center;
            padding: 15px;
            border: 1px solid #e1e1e1;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .calendar-day:hover {
            background: #f0f2ff;
        }

        .calendar-day.selected {
            background: #667eea;
            color: white;
        }

        .calendar-day.disabled {
            background: #f8f9fa;
            color: #ccc;
            cursor: not-allowed;
        }

        .time-slots {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 10px;
            margin-top: 20px;
        }

        .time-slot {
            padding: 10px;
            text-align: center;
            border: 1px solid #e1e1e1;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .time-slot:hover {
            background: #f0f2ff;
        }

        .time-slot.selected {
            background: #667eea;
            color: white;
        }

        .confirmation-section {
            display: none;
            margin-top: 40px;
            text-align: center;
            padding: 30px;
            background: #f8f9fa;
            border-radius: 15px;
            animation: slideUp 0.5s ease-out;
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .confirmation-section i {
            font-size: 4rem;
            color: #28a745;
            margin-bottom: 20px;
        }

        /* Interview Page Styles - UPDATED FOR AI AVATAR */
        .interview-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
            overflow: hidden;
            min-height: 80vh;
        }

        .interview-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .interview-content {
            display: flex;
            height: 70vh;
        }

        .video-section {
            flex: 2;
            background: #1a1a1a;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
            position: relative;
        }

        .video-container {
            width: 100%;
            max-width: 800px;
            background: #2a2a2a;
            border-radius: 15px;
            overflow: hidden;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .video-wrapper {
            display: flex;
            gap: 10px;
            padding: 10px;
            height: 400px;
        }

        .video-box {
            flex: 1;
            background: #333;
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }

        .video-label {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.8rem;
            z-index: 10;
        }

        #localVideo, #remoteVideo {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* AI Avatar Styles */
        .avatar-container {
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            background: #2a2a2a;
            position: relative;
        }

        .avatar {
            width: 80%;
            height: 80%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .avatar-face {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            background: linear-gradient(135deg, #ffd89b 0%, #19547b 100%);
            position: relative;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        .avatar-eyes {
            display: flex;
            justify-content: space-around;
            width: 100px;
            position: absolute;
            top: 60px;
            left: 50px;
        }

        .eye {
            width: 30px;
            height: 40px;
            background: white;
            border-radius: 50%;
            position: relative;
            overflow: hidden;
        }

        .pupil {
            width: 15px;
            height: 15px;
            background: #333;
            border-radius: 50%;
            position: absolute;
            top: 12px;
            left: 7px;
            transition: all 0.3s ease;
        }

        .avatar-mouth {
            width: 80px;
            height: 30px;
            background: #e75480;
            border-radius: 0 0 40px 40px;
            position: absolute;
            bottom: 50px;
            left: 60px;
            transition: all 0.3s ease;
        }

        .avatar-speaking .avatar-mouth {
            animation: speak 0.5s infinite alternate;
        }

        @keyframes speak {
            0% { height: 10px; }
            100% { height: 30px; }
        }

        .avatar-listening .pupil {
            animation: blink 3s infinite;
        }

        @keyframes blink {
            0%, 90%, 100% { transform: scaleY(1); }
            95% { transform: scaleY(0.1); }
        }

        .avatar-positive .avatar-face {
            background: linear-gradient(135deg, #a8ff78 0%, #78ffd6 100%);
        }

        .avatar-encouraging .avatar-face {
            background: linear-gradient(135deg, #ffd89b 0%, #19547b 100%);
        }

        .avatar-constructive .avatar-face {
            background: linear-gradient(135deg, #ff9a9e 0%, #fad0c4 100%);
        }

        .avatar-name {
            margin-top: 20px;
            color: white;
            font-size: 1.2rem;
            font-weight: 600;
        }

        .avatar-status {
            color: #ccc;
            font-size: 0.9rem;
            margin-top: 5px;
        }

        .video-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
        }

        .control-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: none;
            background: #f8f9fa;
            color: #333;
            font-size: 1.3rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .control-btn:hover {
            background: #e9ecef;
            transform: translateY(-2px);
        }

        .control-btn.end-call {
            background: #dc3545;
            color: white;
        }

        .control-btn.end-call:hover {
            background: #c82333;
        }

        .control-btn.active {
            background: #28a745;
            color: white;
        }

        .chat-section {
            flex: 1;
            background: #f8f9fa;
            display: flex;
            flex-direction: column;
            border-left: 1px solid #e1e1e1;
        }

        .chat-header {
            padding: 20px;
            background: white;
            border-bottom: 1px solid #e1e1e1;
            font-weight: 600;
            text-align: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }

        .message {
            margin-bottom: 15px;
            padding: 12px 15px;
            border-radius: 15px;
            max-width: 80%;
            animation: messageSlide 0.3s ease-out;
        }

        @keyframes messageSlide {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .message.received {
            background: white;
            align-self: flex-start;
            border-bottom-left-radius: 5px;
        }

        .message.sent {
            background: #667eea;
            color: white;
            align-self: flex-end;
            border-bottom-right-radius: 5px;
        }

        .message.system {
            background: #f0f0f0;
            align-self: center;
            max-width: 90%;
            text-align: center;
            font-style: italic;
            color: #666;
            border-radius: 10px;
        }

        .chat-input {
            display: flex;
            padding: 20px;
            border-top: 1px solid #e1e1e1;
            background: white;
        }

        .chat-input input {
            flex: 1;
            padding: 12px 15px;
            border: 1px solid #e1e1e1;
            border-radius: 25px;
            margin-right: 10px;
            outline: none;
            transition: all 0.3s ease;
        }

        .chat-input input:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.1);
        }

        .chat-input button {
            padding: 12px 25px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .chat-input button:hover {
            background: #5a6fd8;
            transform: translateY(-1px);
        }

        /* AI Feedback Styles */
        .feedback-container {
            margin-top: 20px;
            padding: 15px;
            background: #fff;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border-left: 4px solid #667eea;
        }

        .feedback-title {
            font-weight: 600;
            margin-bottom: 10px;
            color: #667eea;
        }

        .feedback-item {
            margin-bottom: 8px;
            display: flex;
            align-items: center;
        }

        .feedback-item i {
            margin-right: 10px;
            color: #28a745;
        }

        .score-display {
            text-align: center;
            margin: 20px 0;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 10px;
            font-size: 1.2rem;
            font-weight: 600;
        }

        /* Voice Controls */
        .voice-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 15px;
        }

        .voice-btn {
            padding: 10px 20px;
            border-radius: 25px;
            border: none;
            background: #667eea;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .voice-btn:hover {
            background: #5a6fd8;
            transform: translateY(-2px);
        }

        .voice-btn.active {
            background: #28a745;
            animation: pulse 1.5s infinite;
        }

        .voice-btn.disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(40, 167, 69, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(40, 167, 69, 0); }
            100% { box-shadow: 0 0 0 0 rgba(40, 167, 69, 0); }
        }

        .transcript-container {
            margin-top: 15px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            max-height: 150px;
            overflow-y: auto;
        }

        .transcript-text {
            color: white;
            font-size: 0.9rem;
            line-height: 1.4;
        }

        .transcript-text .highlight {
            background: rgba(255, 255, 255, 0.2);
            padding: 2px 5px;
            border-radius: 3px;
        }

        /* Username Check Styles */
        .username-check {
            margin-top: 10px;
            padding: 10px;
            border-radius: 8px;
            font-weight: 600;
            display: none;
        }

        .username-check.existing {
            background-color: #e7f3ff;
            color: #0066cc;
            border-left: 4px solid #0066cc;
        }

        .username-check.new {
            background-color: #fff3cd;
            color: #856404;
            border-left: 4px solid #ffc107;
        }

        /* Link Status Styles */
        .link-status {
            margin-top: 20px;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            font-weight: 600;
        }

        .link-status.active {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .link-status.inactive {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        /* Email Notification Styles */
        .email-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            padding: 15px 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            z-index: 1000;
            transform: translateX(150%);
            transition: transform 0.3s ease;
        }

        .email-notification.show {
            transform: translateX(0);
        }

        .email-notification i {
            font-size: 1.5rem;
            color: #28a745;
        }

        .email-notification.error {
            border-left: 4px solid #dc3545;
        }

        .email-notification.error i {
            color: #dc3545;
        }

        /* Interview Link Styles */
        .interview-link-container {
            margin: 20px 0;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            text-align: center;
        }

        .interview-link {
            display: inline-block;
            margin: 15px 0;
            padding: 12px 25px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            text-decoration: none;
            border-radius: 25px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .interview-link:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .interview-link.disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .interview-link.disabled:hover {
            transform: none;
            box-shadow: none;
        }

        .countdown-timer {
            font-size: 1.2rem;
            font-weight: 600;
            color: #667eea;
            margin: 15px 0;
        }

        /* Responsive Styles */
        @media (max-width: 768px) {
            .login-container {
                flex-direction: column;
            }
           
            .brand-section, .form-section {
                padding: 40px 30px;
            }

            .interview-content {
                flex-direction: column;
                height: auto;
            }

            .video-section {
                height: 50vh;
            }

            .chat-section {
                height: 40vh;
            }

            .user-welcome {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }

            .calendar {
                grid-template-columns: repeat(4, 1fr);
            }

            .time-slots {
                grid-template-columns: repeat(3, 1fr);
            }

            .video-wrapper {
                flex-direction: column;
                height: auto;
            }

            .video-box {
                height: 200px;
            }

            .voice-controls {
                flex-direction: column;
                align-items: center;
            }

            .email-notification {
                left: 20px;
                right: 20px;
                transform: translateY(-150%);
            }

            .email-notification.show {
                transform: translateY(0);
            }
        }
    </style>
</head>
<body>
    <!-- Email Notification -->
    <div id="email-notification" class="email-notification">
        <i class="fas fa-envelope"></i>
        <div>
            <div id="email-title" style="font-weight: 600;"></div>
            <div id="email-message" style="font-size: 0.9rem;"></div>
        </div>
    </div>

    <!-- Login Page -->
    <div id="login-page" class="page active">
        <div class="login-container">
            <div class="brand-section">
                <h1>CareerCatalyst</h1>
                <p>Your AI-Powered Career Growth Platform</p>
                <div class="features">
                    <div class="feature">
                        <i class="fas fa-briefcase"></i>
                        <span>AI-Powered Job Matching</span>
                    </div>
                   
                    <div class="feature">
                        <i class="fas fa-comments"></i>
                        <span>Smart Mock Interviews</span>
                    </div>
                    <div class="feature">
                        <i class="fas fa-chart-line"></i>
                        <span>Personalized Career Growth</span>
                    </div>
                </div>
            </div>

            <div class="form-section">
                <div class="form-tabs">
                    <div class="form-tab active" data-tab="login">Login</div>
                    <div class="form-tab" data-tab="signup">Create Account</div>
                </div>

                <div id="login-form" class="form-content active">
                    <h2>Welcome Back!</h2>
                    <p>Sign in to your CareerCatalyst account</p>

                    <form id="loginForm">
                        <div class="form-group">
                            <label for="login-username">Username</label>
                            <div class="input-with-icon">
                                <i class="fas fa-user"></i>
                                <input type="text" id="login-username" placeholder="Enter your username" required>
                            </div>
                            <div id="username-check" class="username-check"></div>
                        </div>

                        <div class="form-group">
                            <label for="login-password">Password</label>
                            <div class="input-with-icon">
                                <i class="fas fa-lock"></i>
                                <input type="password" id="login-password" placeholder="Enter your password" required>
                            </div>
                        </div>

                        <div class="remember-forgot">
                            <div class="remember-me">
                                <input type="checkbox" id="remember">
                                <label for="remember">Remember me</label>
                            </div>
                            <a href="#" class="forgot-password">Forgot Password?</a>
                        </div>

                        <button type="submit" class="submit-btn">Sign In</button>
                    </form>
                </div>

                <div id="signup-form" class="form-content">
                    <h2>Create Your Account</h2>
                    <p>Join CareerCatalyst to boost your career</p>

                    <form id="signupForm">
                        <div class="form-group">
                            <label for="signup-username">Username</label>
                            <div class="input-with-icon">
                                <i class="fas fa-user"></i>
                                <input type="text" id="signup-username" placeholder="Choose a username" required>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="signup-email">Email</label>
                            <div class="input-with-icon">
                                <i class="fas fa-envelope"></i>
                                <input type="email" id="signup-email" placeholder="Enter your email" required>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="signup-password">Password</label>
                            <div class="input-with-icon">
                                <i class="fas fa-lock"></i>
                                <input type="password" id="signup-password" placeholder="Create a password" required>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="user-type">I am a</label>
                            <div class="input-with-icon">
                                <i class="fas fa-briefcase"></i>
                                <select id="user-type">
                                    <option value="job-seeker">Job Seeker</option>
                                    <option value="recruiter">Recruiter</option>
                                    <option value="career-coach">Career Coach</option>
                                </select>
                            </div>
                        </div>

                        <button type="submit" class="submit-btn">Create Account</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Dashboard Page -->
    <div id="dashboard-page" class="page">
        <div class="dashboard-container">
            <div class="dashboard-header">
                <div class="user-welcome">
                    <h1>Welcome back, <span id="username-display">User</span>!</h1>
                    <button class="logout-btn" id="logout-btn">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </button>
                </div>
                <p>Your AI career assistant is ready to optimize your job search</p>
            </div>

            <div class="dashboard-content">
                <!-- Stats Section -->
                <div class="stats-section">
                    <div class="stat-card">
                        <i class="fas fa-chart-line"></i>
                        <div class="stat-value">87%</div>
                        <div class="stat-label">AI Resume Score</div>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-briefcase"></i>
                        <div class="stat-value">24</div>
                        <div class="stat-label">Perfect Job Matches</div>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-rocket"></i>
                        <div class="stat-value">+35%</div>
                        <div class="stat-label">Career Growth Potential</div>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-comments"></i>
                        <div class="stat-value">92%</div>
                        <div class="stat-label">Interview Readiness</div>
                    </div>
                </div>

                <!-- AI Career Analysis -->
                <div class="upload-section">
                    <h2><i class="fas fa-chart-bar"></i> AI Career Analysis</h2>
                    <p>Your personalized career insights powered by artificial intelligence</p>
                   
                    <div style="margin: 20px 0;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                            <span>Technical Skills</span>
                            <span>85%</span>
                        </div>
                        <div style="background: #e9ecef; border-radius: 10px; height: 10px;">
                            <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); width: 85%; height: 100%; border-radius: 10px;"></div>
                        </div>
                    </div>
                   
                    <div style="margin: 20px 0;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                            <span>Leadership Potential</span>
                            <span>78%</span>
                        </div>
                        <div style="background: #e9ecef; border-radius: 10px; height: 10px;">
                            <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); width: 78%; height: 100%; border-radius: 10px;"></div>
                        </div>
                    </div>
                </div>

                <div class="upload-section">
                    <h2><i class="fas fa-file-upload"></i> Upload Your Resume</h2>
                    <p>Upload your resume in PDF, DOC, or DOCX format (max 5MB)</p>
                   
                    <div class="upload-area" id="resume-upload-area">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <p>Drag & Drop your resume here</p>
                        <small>or click to browse files</small>
                        <input type="file" id="resume-file" class="file-input" accept=".pdf,.doc,.docx">
                    </div>
                    <div id="resume-filename" style="margin-top: 10px; font-weight: 600; color: #667eea;"></div>
                </div>

                <div class="job-description">
                    <h2><i class="fas fa-file-alt"></i> Job Description</h2>
                    <p>Paste the job description you're targeting</p>
                    <textarea id="job-description-text" placeholder="Paste the full job description here..."></textarea>
                </div>

                <div class="schedule-section">
                    <h2><i class="fas fa-calendar-alt"></i> Schedule Your Mock Interview</h2>
                    <p>Select a date and time for your mock interview</p>

                    <div class="calendar-container">
                        <h3>Select a Date</h3>
                        <div class="calendar" id="calendar">
                            <!-- Calendar will be generated by JavaScript -->
                        </div>
                    </div>

                    <div class="time-slots-container">
                        <h3>Select a Time Slot</h3>
                        <div class="time-slots" id="time-slots">
                            <!-- Time slots will be generated by JavaScript -->
                        </div>
                    </div>

                    <button class="submit-btn" id="schedule-btn" style="margin-top: 30px;">
                        <i class="fas fa-calendar-check"></i> Schedule Interview
                    </button>
                </div>

                <div class="confirmation-section" id="confirmation-section">
                    <i class="fas fa-check-circle"></i>
                    <h2>Interview Scheduled Successfully!</h2>
                    <p>Your mock interview has been scheduled for <span id="scheduled-date-time">Date and Time</span>.</p>
                    <p>We've sent a confirmation email with the interview link to your registered email address.</p>
                    <p>You can also access your interview from this link:</p>
                    
                    <div class="interview-link-container">
                        <a href="#" class="interview-link" id="interview-link-btn">
                            <i class="fas fa-video"></i> Join Interview
                        </a>
                        <div class="countdown-timer" id="countdown-timer"></div>
                        <div id="link-status" class="link-status inactive">
                            <i class="fas fa-exclamation-circle"></i>
                            <span id="link-status-text">This interview link is not yet active</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Interview Page -->
    <div id="interview-page" class="page">
        <div class="interview-container">
            <div class="interview-header">
                <h1><i class="fas fa-video"></i> CareerCatalyst Mock Interview</h1>
                <div>
                    <span id="interview-timer">00:00:00</span>
                    <button class="logout-btn" id="end-interview-btn">
                        <i class="fas fa-phone-slash"></i> End Call
                    </button>
                </div>
            </div>

            <div class="interview-content">
                <div class="video-section">
                    <div class="video-container">
                        <div class="video-wrapper">
                            <div class="video-box">
                                <div class="video-label">You</div>
                                <video id="localVideo" autoplay playsinline muted></video>
                            </div>
                            <div class="video-box">
                                <div class="video-label">AI Interviewer</div>
                                <div class="avatar-container" id="avatar-container">
                                    <div class="avatar" id="avatar">
                                        <div class="avatar-face" id="avatar-face">
                                            <div class="avatar-eyes">
                                                <div class="eye">
                                                    <div class="pupil"></div>
                                                </div>
                                                <div class="eye">
                                                    <div class="pupil"></div>
                                                </div>
                                            </div>
                                            <div class="avatar-mouth" id="avatar-mouth"></div>
                                        </div>
                                        <div class="avatar-name">Alex, AI Interviewer</div>
                                        <div class="avatar-status" id="avatar-status">Ready to begin</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                   
                    <!-- Voice Controls -->
                    <div class="voice-controls">
                        <button class="voice-btn" id="voice-input-btn">
                            <i class="fas fa-microphone"></i> Voice Input
                        </button>
                        <button class="voice-btn" id="ai-voice-btn">
                            <i class="fas fa-robot"></i> AI Voice
                        </button>
                    </div>
                   
                    <!-- Transcript Display -->
                    <div class="transcript-container" id="transcript-container" style="display: none;">
                        <div class="transcript-text" id="transcript-text">Listening...</div>
                    </div>
                   
                    <div class="video-controls">
                        <button class="control-btn" id="start-call-btn">
                            <i class="fas fa-play"></i>
                        </button>
                        <button class="control-btn" id="mic-btn">
                            <i class="fas fa-microphone"></i>
                        </button>
                        <button class="control-btn" id="camera-btn">
                            <i class="fas fa-video"></i>
                        </button>
                        <button class="control-btn end-call" id="leave-btn">
                            <i class="fas fa-phone-slash"></i>
                        </button>
                    </div>
                </div>

                <div class="chat-section">
                    <div class="chat-header">
                        <i class="fas fa-comments"></i> Interview Chat
                    </div>
                    <div class="chat-messages" id="chat-messages">
                        <div class="message received">
                            <strong>AI Interviewer:</strong> Hello! Welcome to your mock interview. I'll be asking you a series of questions to evaluate your skills. Are you ready to begin?
                        </div>
                    </div>
                    <div class="chat-input">
                        <input type="text" id="chat-input" placeholder="Type your answer...">
                        <button id="send-btn">
                            <i class="fas fa-paper-plane"></i> Send
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // DOM Elements
        const loginPage = document.getElementById('login-page');
        const dashboardPage = document.getElementById('dashboard-page');
        const interviewPage = document.getElementById('interview-page');
       
        const loginForm = document.getElementById('loginForm');
        const signupForm = document.getElementById('signupForm');
        const formTabs = document.querySelectorAll('.form-tab');
        const formContents = document.querySelectorAll('.form-content');
       
        const usernameDisplay = document.getElementById('username-display');
        const logoutBtn = document.getElementById('logout-btn');
       
        const resumeUploadArea = document.getElementById('resume-upload-area');
        const resumeFileInput = document.getElementById('resume-file');
        const resumeFilename = document.getElementById('resume-filename');
       
        const scheduleBtn = document.getElementById('schedule-btn');
        const confirmationSection = document.getElementById('confirmation-section');
        const interviewLinkBtn = document.getElementById('interview-link-btn');
        const linkStatus = document.getElementById('link-status');
        const linkStatusText = document.getElementById('link-status-text');
        const countdownTimer = document.getElementById('countdown-timer');
       
        const endInterviewBtn = document.getElementById('end-interview-btn');
        const chatInput = document.getElementById('chat-input');
        const sendBtn = document.getElementById('send-btn');
        const chatMessages = document.getElementById('chat-messages');
       
        // AI Avatar Elements
        const avatarContainer = document.getElementById('avatar-container');
        const avatarFace = document.getElementById('avatar-face');
        const avatarMouth = document.getElementById('avatar-mouth');
        const avatarStatus = document.getElementById('avatar-status');
       
        // Username check element
        const usernameCheck = document.getElementById('username-check');
        const loginUsernameInput = document.getElementById('login-username');
       
        // Email notification elements
        const emailNotification = document.getElementById('email-notification');
        const emailTitle = document.getElementById('email-title');
        const emailMessage = document.getElementById('email-message');
       
        // Voice elements
        const voiceInputBtn = document.getElementById('voice-input-btn');
        const aiVoiceBtn = document.getElementById('ai-voice-btn');
        const transcriptContainer = document.getElementById('transcript-container');
        const transcriptText = document.getElementById('transcript-text');
       
        // Global variables
        let currentUser = null;
        let selectedDate = null;
        let selectedTime = null;
        let interviewTimer = null;
        let timerSeconds = 0;
        let scheduledInterview = null;
        let linkStatusInterval = null;

        // Voice recognition variables
        let recognition = null;
        let isListening = false;
        let finalTranscript = '';
        let interimTranscript = '';
        let aiVoiceEnabled = false;
        let isSpeaking = false;

        // ==================== ADAPTIVE INTERVIEW SYSTEM ====================
        
        // Interview State
        let currentQuestionIndex = -1;
        let interviewScore = 0;
        let questionFeedback = [];
        let userPerformance = [];
        let interviewPhase = 'introduction'; // introduction, technical, behavioral, closing
        
        // Question Banks
        const technicalQuestions = [
            {
                question: "Can you explain the concept of object-oriented programming and its main principles?",
                keywords: ["encapsulation", "inheritance", "polymorphism", "abstraction", "classes", "objects"],
                difficulty: "medium",
                category: "fundamentals"
            },
            {
                question: "How would you optimize a slow database query in a web application?",
                keywords: ["indexing", "query optimization", "database", "performance", "execution plan"],
                difficulty: "hard",
                category: "databases"
            },
            {
                question: "What's the difference between REST and GraphQL APIs? When would you choose one over the other?",
                keywords: ["rest", "graphql", "api", "endpoints", "overfetching", "underfetching"],
                difficulty: "medium",
                category: "web development"
            },
            {
                question: "Can you explain how JavaScript's event loop works?",
                keywords: ["event loop", "call stack", "callback queue", "microtasks", "macrotasks", "async"],
                difficulty: "hard",
                category: "javascript"
            },
            {
                question: "What are some common security vulnerabilities in web applications and how do you prevent them?",
                keywords: ["xss", "csrf", "sql injection", "authentication", "authorization", "https"],
                difficulty: "medium",
                category: "security"
            }
        ];

        const behavioralQuestions = [
            {
                question: "Tell me about a time you had to deal with a difficult team member. How did you handle it?",
                keywords: ["conflict", "teamwork", "communication", "resolution", "professional"],
                difficulty: "medium",
                category: "teamwork"
            },
            {
                question: "Describe a situation where you had to make an important decision with limited information.",
                keywords: ["decision", "uncertainty", "analysis", "risk", "outcome"],
                difficulty: "medium",
                category: "decision-making"
            },
            {
                question: "Can you give an example of a time you failed at something? What did you learn from it?",
                keywords: ["failure", "learning", "improvement", "resilience", "growth"],
                difficulty: "easy",
                category: "growth-mindset"
            },
            {
                question: "Tell me about a project where you had to learn a new technology quickly.",
                keywords: ["learning", "adaptability", "research", "implementation", "deadline"],
                difficulty: "medium",
                category: "adaptability"
            },
            {
                question: "Describe a situation where you had to persuade others to adopt your idea or approach.",
                keywords: ["persuasion", "influence", "communication", "benefits", "collaboration"],
                difficulty: "hard",
                category: "leadership"
            }
        ];

        const followUpQuestions = {
            "strong": [
                "That's an excellent answer. Let me ask you a more advanced question on this topic: ",
                "Great insights! Building on that, how would you handle this more complex scenario: ",
                "I appreciate your thorough response. Let's explore this further: ",
                "You clearly have strong knowledge in this area. Let me challenge you with: "
            ],
            "weak": [
                "I see what you're getting at. Let me rephrase that to help clarify: ",
                "That's a good start. Let me ask a follow-up to help you elaborate: ",
                "I understand the direction you're going. Could you provide more specific examples about: ",
                "Let me help you structure your thoughts better. Consider this aspect: "
            ],
            "irrelevant": [
                "That's an interesting perspective, but let's focus back on the original question about ",
                "I appreciate your input, but for this interview, let's concentrate on ",
                "That's good to know, but returning to our discussion about ",
                "Let me redirect us back to the main topic of "
            ]
        };

        // WebRTC Variables
        let localStream;
        let peerConnection;
        const configuration = {
            iceServers: [
                { urls: 'stun:stun.l.google.com:19302' },
                { urls: 'stun:stun1.l.google.com:19302' }
            ]
        };

        // Initialize the application
        function init() {
            // Check if user is already logged in
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                showDashboard();
            }
           
            // Set up event listeners
            setupEventListeners();
           
            // Generate calendar
            generateCalendar();
           
            // Generate time slots
            generateTimeSlots();
           
            // Initialize voice recognition if available
            initVoiceRecognition();
        }

        // Set up all event listeners
        function setupEventListeners() {
            // Form tab switching
            formTabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const tabId = tab.getAttribute('data-tab');
                    switchFormTab(tabId);
                });
            });
           
            // Login form submission
            loginForm.addEventListener('submit', handleLogin);
           
            // Signup form submission
            signupForm.addEventListener('submit', handleSignup);
           
            // Logout button
            logoutBtn.addEventListener('click', handleLogout);
           
            // Resume upload
            resumeUploadArea.addEventListener('click', () => resumeFileInput.click());
            resumeFileInput.addEventListener('change', handleResumeUpload);
           
            // Schedule interview button
            scheduleBtn.addEventListener('click', scheduleInterview);
           
            // Interview link button
            interviewLinkBtn.addEventListener('click', startInterview);
           
            // Interview controls
            endInterviewBtn.addEventListener('click', endInterview);
            sendBtn.addEventListener('click', sendMessage);
            chatInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') sendMessage();
            });
           
            // Control buttons in interview
            document.getElementById('mic-btn').addEventListener('click', toggleMic);
            document.getElementById('camera-btn').addEventListener('click', toggleCamera);
            document.getElementById('start-call-btn').addEventListener('click', startInterviewCall);
            document.getElementById('leave-btn').addEventListener('click', endInterviewCall);
           
            // Voice controls
            voiceInputBtn.addEventListener('click', toggleVoiceInput);
            aiVoiceBtn.addEventListener('click', toggleAIVoice);
           
            // Username check
            loginUsernameInput.addEventListener('blur', checkUsername);
        }

        // ==================== AI AVATAR FUNCTIONS ====================

        // Update avatar state based on interaction
        function updateAvatarState(state, message = '') {
            // Remove all state classes
            avatarFace.classList.remove('avatar-speaking', 'avatar-listening', 'avatar-positive', 'avatar-encouraging', 'avatar-constructive');
            
            // Update status message
            if (message) {
                avatarStatus.textContent = message;
            }
            
            // Apply new state
            switch(state) {
                case 'speaking':
                    avatarFace.classList.add('avatar-speaking');
                    avatarStatus.textContent = 'Speaking...';
                    break;
                case 'listening':
                    avatarFace.classList.add('avatar-listening');
                    avatarStatus.textContent = 'Listening to your answer...';
                    break;
                case 'positive':
                    avatarFace.classList.add('avatar-positive');
                    avatarStatus.textContent = 'Impressed with your answer!';
                    break;
                case 'encouraging':
                    avatarFace.classList.add('avatar-encouraging');
                    avatarStatus.textContent = 'Encouraging you to continue...';
                    break;
                case 'constructive':
                    avatarFace.classList.add('avatar-constructive');
                    avatarStatus.textContent = 'Providing constructive feedback...';
                    break;
                default:
                    avatarStatus.textContent = 'Ready to continue';
            }
        }

        // Speak text with avatar lip sync
        function speakTextWithAvatar(text) {
            if (!aiVoiceEnabled) return;
           
            if ('speechSynthesis' in window) {
                // Stop any ongoing speech
                window.speechSynthesis.cancel();
               
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.rate = 0.9; // Slightly slower for clarity
                utterance.pitch = 1;
                utterance.volume = 0.8;
               
                // Try to use a more natural voice if available
                const voices = window.speechSynthesis.getVoices();
                const preferredVoice = voices.find(voice =>
                    voice.name.includes('Google') ||
                    voice.name.includes('Samantha') ||
                    voice.name.includes('Microsoft David')
                );
               
                if (preferredVoice) {
                    utterance.voice = preferredVoice;
                }
               
                // Start speaking animation
                isSpeaking = true;
                updateAvatarState('speaking');
               
                utterance.onstart = () => {
                    isSpeaking = true;
                };
               
                utterance.onend = () => {
                    isSpeaking = false;
                    updateAvatarState('listening');
                };
               
                window.speechSynthesis.speak(utterance);
            }
        }

        // ==================== ADAPTIVE INTERVIEW FUNCTIONS ====================

        // Start AI Interview
        function startAIInterview() {
            currentQuestionIndex = -1;
            interviewScore = 0;
            questionFeedback = [];
            userPerformance = [];
            interviewPhase = 'introduction';
            
            // Clear existing messages except the first one
            const messages = document.querySelectorAll('.message');
            for (let i = 1; i < messages.length; i++) {
                messages[i].remove();
            }
            
            // Start with introduction
            setTimeout(() => {
                askAdaptiveQuestion();
            }, 1000);
        }

        // Ask adaptive question based on user performance
        function askAdaptiveQuestion() {
            currentQuestionIndex++;
            
            let question;
            
            // Determine question based on interview phase and performance
            if (interviewPhase === 'introduction') {
                question = "Let's start with a brief introduction. Could you tell me about your professional background and what brings you here today?";
                interviewPhase = 'technical';
            } else if (interviewPhase === 'technical') {
                // Select technical question based on previous performance
                const lastPerformance = userPerformance.length > 0 ? userPerformance[userPerformance.length - 1] : null;
                
                if (lastPerformance && lastPerformance.score >= 8) {
                    // Strong performance - ask harder question
                    question = getQuestionByDifficulty('hard', 'technical');
                    updateAvatarState('positive', 'Asking a challenging question');
                } else if (lastPerformance && lastPerformance.score <= 5) {
                    // Weak performance - ask easier question or give another chance
                    question = getQuestionByDifficulty('medium', 'technical');
                    updateAvatarState('encouraging', 'Let me rephrase that for you');
                } else {
                    // Average or first technical question
                    question = getQuestionByDifficulty('medium', 'technical');
                    updateAvatarState('encouraging', 'Continuing with technical questions');
                }
                
                // Transition to behavioral after 2-3 technical questions
                if (currentQuestionIndex >= 3) {
                    interviewPhase = 'behavioral';
                }
            } else if (interviewPhase === 'behavioral') {
                // Select behavioral question
                const lastPerformance = userPerformance.length > 0 ? userPerformance[userPerformance.length - 1] : null;
                
                if (lastPerformance && lastPerformance.score >= 8) {
                    question = getQuestionByDifficulty('hard', 'behavioral');
                    updateAvatarState('positive', 'Exploring your behavioral strengths');
                } else {
                    question = getQuestionByDifficulty('medium', 'behavioral');
                    updateAvatarState('encouraging', 'Let me ask about your experiences');
                }
                
                // Transition to closing after 2 behavioral questions
                if (currentQuestionIndex >= 5) {
                    interviewPhase = 'closing';
                }
            } else if (interviewPhase === 'closing') {
                endAIInterview();
                return;
            }
            
            // Add the question to the chat
            const questionElement = document.createElement('div');
            questionElement.className = 'message received';
            questionElement.innerHTML = `<strong>AI Interviewer:</strong> ${question}`;
            chatMessages.appendChild(questionElement);
           
            // Speak the question if AI voice is enabled
            speakTextWithAvatar(question);
           
            // Scroll to bottom
            chatMessages.scrollTop = chatMessages.scrollHeight;
            
            // Store current question for evaluation
            window.currentQuestion = question;
        }

        // Get question by difficulty and category
        function getQuestionByDifficulty(difficulty, category) {
            const questionBank = category === 'technical' ? technicalQuestions : behavioralQuestions;
            const filteredQuestions = questionBank.filter(q => q.difficulty === difficulty);
            
            if (filteredQuestions.length === 0) {
                // Fallback to any question if no matches
                return questionBank[Math.floor(Math.random() * questionBank.length)].question;
            }
            
            return filteredQuestions[Math.floor(Math.random() * filteredQuestions.length)].question;
        }

        // Evaluate user's answer and provide adaptive response
        function evaluateAndRespond(answer) {
            const question = window.currentQuestion;
            let score = 0;
            let feedback = "";
            let responseType = "neutral";
            
            // Simple evaluation based on answer length and keyword matching
            const answerLength = answer.trim().length;
            const answerLower = answer.toLowerCase();
            
            // Check for relevance to question
            let relevanceScore = 0;
            let keywordMatches = 0;
            
            // Combine keywords from both question banks
            const allQuestions = [...technicalQuestions, ...behavioralQuestions];
            const currentQ = allQuestions.find(q => q.question === question);
            
            if (currentQ && currentQ.keywords) {
                currentQ.keywords.forEach(keyword => {
                    if (answerLower.includes(keyword)) {
                        keywordMatches++;
                    }
                });
                relevanceScore = (keywordMatches / currentQ.keywords.length) * 10;
            }
            
            // Calculate overall score
            score = Math.min(10, 
                (answerLength > 100 ? 3 : answerLength > 50 ? 2 : 1) + 
                relevanceScore + 
                (answerLower.includes('experience') || answerLower.includes('example') ? 2 : 0) +
                (answerLower.includes('learned') || answerLower.includes('improved') ? 2 : 0)
            );
            
            // Determine response type and feedback
            if (score >= 8) {
                responseType = "strong";
                feedback = getRandomResponse(followUpQuestions.strong) + getQuestionByDifficulty('hard', interviewPhase === 'technical' ? 'technical' : 'behavioral');
                updateAvatarState('positive', 'Excellent answer!');
            } else if (score >= 5) {
                responseType = "neutral";
                feedback = "Thank you for your answer. " + getQuestionByDifficulty('medium', interviewPhase === 'technical' ? 'technical' : 'behavioral');
                updateAvatarState('encouraging', 'Good response, let me ask another question');
            } else {
                responseType = "weak";
                feedback = getRandomResponse(followUpQuestions.weak) + getQuestionByDifficulty('medium', interviewPhase === 'technical' ? 'technical' : 'behavioral');
                updateAvatarState('constructive', 'Let me help you elaborate');
            }
            
            // Check for completely irrelevant answers
            if (score <= 2 && answerLength > 20) {
                responseType = "irrelevant";
                feedback = getRandomResponse(followUpQuestions.irrelevant) + (currentQ ? currentQ.keywords[0] : "the topic");
                updateAvatarState('constructive', 'Let me redirect to the main topic');
            }
            
            // Store performance data
            userPerformance.push({
                question: question,
                answer: answer,
                score: score,
                responseType: responseType
            });
            
            // Update overall score
            interviewScore += score;
            
            return { score, feedback, responseType };
        }

        // Get random response from array
        function getRandomResponse(responses) {
            return responses[Math.floor(Math.random() * responses.length)];
        }

        // End the AI interview and show results
        function endAIInterview() {
            // Calculate final score
            const finalScore = Math.round(interviewScore / Math.max(userPerformance.length, 1));
            
            // Add final message to chat
            const finalMessage = document.createElement('div');
            finalMessage.className = 'message system';
            finalMessage.innerHTML = `<strong>Interview Complete!</strong>`;
            chatMessages.appendChild(finalMessage);
           
            // Add feedback container
            const feedbackContainer = document.createElement('div');
            feedbackContainer.className = 'feedback-container';
           
            const feedbackTitle = document.createElement('div');
            feedbackTitle.className = 'feedback-title';
            feedbackTitle.textContent = 'Interview Feedback & Summary';
            feedbackContainer.appendChild(feedbackTitle);
           
            const scoreDisplay = document.createElement('div');
            scoreDisplay.className = 'score-display';
            scoreDisplay.textContent = `Overall Performance: ${finalScore}/10`;
            feedbackContainer.appendChild(scoreDisplay);
           
            // Add performance analysis
            const performanceAnalysis = document.createElement('div');
            performanceAnalysis.style.marginTop = '15px';
            
            const strongAnswers = userPerformance.filter(p => p.responseType === 'strong').length;
            const weakAnswers = userPerformance.filter(p => p.responseType === 'weak' || p.responseType === 'irrelevant').length;
            
            performanceAnalysis.innerHTML = `
                <div style="margin-bottom: 10px;">
                    <strong>Performance Breakdown:</strong><br>
                    • Strong Answers: ${strongAnswers}<br>
                    • Areas for Improvement: ${weakAnswers}<br>
                    • Total Questions: ${userPerformance.length}
                </div>
            `;
            feedbackContainer.appendChild(performanceAnalysis);
            
            // Add improvement suggestions
            const suggestions = document.createElement('div');
            suggestions.className = 'feedback-item';
            suggestions.innerHTML = `
                <i class="fas fa-lightbulb"></i>
                <div>
                    <strong>Recommendations:</strong> ${getOverallSuggestions(finalScore, strongAnswers, weakAnswers)}
                </div>
            `;
            feedbackContainer.appendChild(suggestions);
           
            chatMessages.appendChild(feedbackContainer);
           
            // Scroll to bottom
            chatMessages.scrollTop = chatMessages.scrollHeight;
           
            // Disable chat input
            chatInput.disabled = true;
            sendBtn.disabled = true;
            chatInput.placeholder = "Interview completed";
           
            // Stop voice recognition if active
            if (isListening) {
                stopVoiceRecognition();
            }
            
            // Update avatar state
            updateAvatarState('positive', 'Interview completed! Check your feedback below.');
        }

        // Get overall suggestions based on final score
        function getOverallSuggestions(score, strongAnswers, weakAnswers) {
            if (score >= 9) {
                return "Outstanding performance! You demonstrated excellent technical knowledge and strong communication skills. You're well-prepared for real interviews.";
            } else if (score >= 7) {
                return "Strong performance. Focus on providing more specific examples and expanding your answers with measurable results.";
            } else if (score >= 5) {
                return "Good foundation. Practice structuring your answers using the STAR method and research common interview questions in your field.";
            } else {
                return "Needs improvement. Consider practicing common interview questions, researching companies thoroughly, and working on clear communication of your experiences.";
            }
        }

        // ==================== EXISTING FUNCTIONALITY (UNCHANGED) ====================

        // Show email notification
        function showEmailNotification(title, message, isSuccess = true) {
            emailTitle.textContent = title;
            emailMessage.textContent = message;
            emailNotification.className = `email-notification ${isSuccess ? 'success' : 'error'}`;
            emailNotification.classList.add('show');
           
            setTimeout(() => {
                emailNotification.classList.remove('show');
            }, 5000);
        }

        // Check if username exists
        function checkUsername() {
            const username = loginUsernameInput.value.trim();
            if (!username) return;
           
            // Get existing users from localStorage
            const existingUsers = JSON.parse(localStorage.getItem('users') || '[]');
            const userExists = existingUsers.some(user => user.username === username);
           
            if (userExists) {
                usernameCheck.textContent = 'Welcome back! Please enter your password.';
                usernameCheck.className = 'username-check existing';
                usernameCheck.style.display = 'block';
            } else {
                usernameCheck.textContent = 'You seem to be a new user. Please create your account.';
                usernameCheck.className = 'username-check new';
                usernameCheck.style.display = 'block';
            }
        }

        // Initialize voice recognition
        function initVoiceRecognition() {
            // Check if browser supports speech recognition
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                recognition = new SpeechRecognition();
               
                recognition.continuous = true;
                recognition.interimResults = true;
                recognition.lang = 'en-US';
               
                recognition.onstart = () => {
                    console.log('Voice recognition started');
                    isListening = true;
                    voiceInputBtn.classList.add('active');
                    transcriptContainer.style.display = 'block';
                    updateAvatarState('listening', 'Listening to your answer...');
                };
               
                recognition.onresult = (event) => {
                    interimTranscript = '';
                   
                    for (let i = event.resultIndex; i < event.results.length; i++) {
                        const transcript = event.results[i][0].transcript;
                        if (event.results[i].isFinal) {
                            finalTranscript += transcript + ' ';
                        } else {
                            interimTranscript += transcript;
                        }
                    }
                   
                    // Update transcript display
                    transcriptText.innerHTML = finalTranscript + '<span class="highlight">' + interimTranscript + '</span>';
                   
                    // Auto-scroll to bottom
                    transcriptContainer.scrollTop = transcriptContainer.scrollHeight;
                };
               
                recognition.onerror = (event) => {
                    console.error('Speech recognition error:', event.error);
                    if (event.error === 'not-allowed') {
                        alert('Microphone access is required for voice input. Please allow microphone access and try again.');
                    }
                    stopVoiceRecognition();
                };
               
                recognition.onend = () => {
                    console.log('Voice recognition ended');
                    if (isListening) {
                        // Restart recognition if it ended unexpectedly
                        recognition.start();
                    } else {
                        voiceInputBtn.classList.remove('active');
                        transcriptContainer.style.display = 'none';
                        updateAvatarState('encouraging', 'Ready for your response');
                    }
                };
            } else {
                // Browser doesn't support speech recognition
                voiceInputBtn.disabled = true;
                voiceInputBtn.classList.add('disabled');
                voiceInputBtn.innerHTML = '<i class="fas fa-microphone-slash"></i> Voice Not Supported';
            }
        }

        // Toggle voice input
        function toggleVoiceInput() {
            if (!recognition) {
                alert('Your browser does not support voice recognition. Please use a modern browser like Chrome or Edge.');
                return;
            }
           
            if (isListening) {
                stopVoiceRecognition();
            } else {
                startVoiceRecognition();
            }
        }

        // Start voice recognition
        function startVoiceRecognition() {
            if (recognition && !isListening) {
                finalTranscript = '';
                interimTranscript = '';
                transcriptText.textContent = 'Listening...';
                recognition.start();
            }
        }

        // Stop voice recognition
        function stopVoiceRecognition() {
            if (recognition && isListening) {
                isListening = false;
                recognition.stop();
               
                // Use the final transcript as the chat input
                if (finalTranscript.trim()) {
                    chatInput.value = finalTranscript.trim();
                    sendMessage();
                }
            }
        }

        // Toggle AI voice
        function toggleAIVoice() {
            aiVoiceEnabled = !aiVoiceEnabled;
           
            if (aiVoiceEnabled) {
                aiVoiceBtn.classList.add('active');
                aiVoiceBtn.innerHTML = '<i class="fas fa-robot"></i> AI Voice ON';
            } else {
                aiVoiceBtn.classList.remove('active');
                aiVoiceBtn.innerHTML = '<i class="fas fa-robot"></i> AI Voice OFF';
            }
        }

        // Speak text using the Web Speech API
        function speakText(text) {
            if (!aiVoiceEnabled) return;
           
            if ('speechSynthesis' in window) {
                // Stop any ongoing speech
                window.speechSynthesis.cancel();
               
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.rate = 0.9; // Slightly slower for clarity
                utterance.pitch = 1;
                utterance.volume = 0.8;
               
                // Try to use a more natural voice if available
                const voices = window.speechSynthesis.getVoices();
                const preferredVoice = voices.find(voice =>
                    voice.name.includes('Google') ||
                    voice.name.includes('Samantha') ||
                    voice.name.includes('Microsoft David')
                );
               
                if (preferredVoice) {
                    utterance.voice = preferredVoice;
                }
               
                window.speechSynthesis.speak(utterance);
            }
        }

        // Switch between login and signup forms
        function switchFormTab(tabId) {
            formTabs.forEach(tab => {
                if (tab.getAttribute('data-tab') === tabId) {
                    tab.classList.add('active');
                } else {
                    tab.classList.remove('active');
                }
            });
           
            formContents.forEach(content => {
                if (content.id === `${tabId}-form`) {
                    content.classList.add('active');
                } else {
                    content.classList.remove('active');
                }
            });
        }

        // Handle login
        function handleLogin(e) {
            e.preventDefault();
            const username = document.getElementById('login-username').value;
            const password = document.getElementById('login-password').value;
           
            if (username && password) {
                // Get existing users from localStorage
                const existingUsers = JSON.parse(localStorage.getItem('users') || '[]');
                const user = existingUsers.find(user => user.username === username);
               
                if (user) {
                    // User exists, verify password
                    if (user.password === password) {
                        currentUser = user;
                       
                        // Save user to localStorage
                        localStorage.setItem('currentUser', JSON.stringify(currentUser));
                       
                        showDashboard();
                    } else {
                        alert('Incorrect password. Please try again.');
                    }
                } else {
                    alert('Username not found. Please create an account.');
                }
            } else {
                alert('Please enter both username and password.');
            }
        }

        // Handle signup
        function handleSignup(e) {
            e.preventDefault();
            const username = document.getElementById('signup-username').value;
            const email = document.getElementById('signup-email').value;
            const password = document.getElementById('signup-password').value;
            const userType = document.getElementById('user-type').value;
           
            if (username && email && password) {
                // Get existing users from localStorage
                const existingUsers = JSON.parse(localStorage.getItem('users') || '[]');
               
                // Check if username already exists
                if (existingUsers.some(user => user.username === username)) {
                    alert('Username already exists. Please choose a different username.');
                    return;
                }
               
                // Create new user
                currentUser = {
                    username: username,
                    email: email,
                    password: password,
                    type: userType
                };
               
                // Save user to users list
                existingUsers.push(currentUser);
                localStorage.setItem('users', JSON.stringify(existingUsers));
               
                // Save current user
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
               
                showDashboard();
            } else {
                alert('Please fill in all fields.');
            }
        }

        // Handle logout
        function handleLogout() {
            currentUser = null;
            localStorage.removeItem('currentUser');
            showLogin();
        }

        // Show login page
        function showLogin() {
            loginPage.classList.add('active');
            dashboardPage.classList.remove('active');
            interviewPage.classList.remove('active');
           
            // Reset forms
            loginForm.reset();
            signupForm.reset();
            usernameCheck.style.display = 'none';
        }

        // Show dashboard page
        function showDashboard() {
            loginPage.classList.remove('active');
            dashboardPage.classList.add('active');
            interviewPage.classList.remove('active');
           
            // Update username display
            usernameDisplay.textContent = currentUser.username;
           
            // Check if there's a scheduled interview and update link status
            checkInterviewLinkStatus();
            
            // Start checking link status continuously
            startLinkStatusChecker();
        }

        // Show interview page
        function showInterview() {
            loginPage.classList.remove('active');
            dashboardPage.classList.remove('active');
            interviewPage.classList.add('active');
           
            // Start interview timer
            startInterviewTimer();
           
            // Start the AI interview
            startAIInterview();
        }

        // Handle resume upload
        function handleResumeUpload(e) {
            const file = e.target.files[0];
            if (file) {
                // Check file size (5MB limit)
                if (file.size > 5 * 1024 * 1024) {
                    alert('File size exceeds 5MB limit. Please choose a smaller file.');
                    return;
                }
               
                // Display filename
                resumeFilename.textContent = `Selected: ${file.name}`;
                resumeUploadArea.style.borderColor = '#28a745';
               
                // Simulate AI analysis
                setTimeout(() => {
                    alert('AI analysis complete! Your resume has been optimized.');
                }, 2000);
            }
        }

        // Generate calendar for the next 7 days
        function generateCalendar() {
            const calendar = document.getElementById('calendar');
            calendar.innerHTML = '';
           
            // Add day headers
            const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            days.forEach(day => {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-header';
                dayElement.textContent = day;
                calendar.appendChild(dayElement);
            });
           
            // Get today's date
            const today = new Date();
           
            // Generate days for the next 7 days
            for (let i = 0; i < 7; i++) {
                const date = new Date(today);
                date.setDate(today.getDate() + i);
               
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                dayElement.textContent = date.getDate();
                dayElement.setAttribute('data-date', date.toISOString().split('T')[0]);
               
                // Mark today
                if (i === 0) {
                    dayElement.innerHTML += '<br><small>Today</small>';
                }
               
                dayElement.addEventListener('click', () => selectDate(dayElement));
                calendar.appendChild(dayElement);
            }
        }

        // Generate time slots
        function generateTimeSlots() {
            const timeSlotsContainer = document.getElementById('time-slots');
            timeSlotsContainer.innerHTML = '';
           
            const timeSlots = [
                '9:00 AM', '10:00 AM', '11:00 AM',
                '1:00 PM', '2:00 PM', '3:00 PM', '4:00 PM'
            ];
           
            timeSlots.forEach(time => {
                const timeSlot = document.createElement('div');
                timeSlot.className = 'time-slot';
                timeSlot.textContent = time;
                timeSlot.setAttribute('data-time', time);
               
                timeSlot.addEventListener('click', () => selectTime(timeSlot));
                timeSlotsContainer.appendChild(timeSlot);
            });
        }

        // Select date for interview
        function selectDate(dayElement) {
            // Remove selected class from all days
            document.querySelectorAll('.calendar-day').forEach(day => {
                day.classList.remove('selected');
            });
           
            // Add selected class to clicked day
            dayElement.classList.add('selected');
            selectedDate = dayElement.getAttribute('data-date');
        }

        // Select time for interview
        function selectTime(timeSlot) {
            // Remove selected class from all time slots
            document.querySelectorAll('.time-slot').forEach(slot => {
                slot.classList.remove('selected');
            });
           
            // Add selected class to clicked time slot
            timeSlot.classList.add('selected');
            selectedTime = timeSlot.getAttribute('data-time');
        }

        // Schedule interview
        function scheduleInterview() {
            const jobDescription = document.getElementById('job-description-text').value;
           
            if (!resumeFileInput.files[0]) {
                alert('Please upload your resume first.');
                return;
            }
           
            if (!jobDescription) {
                alert('Please paste a job description.');
                return;
            }
           
            if (!selectedDate || !selectedTime) {
                alert('Please select a date and time for your interview.');
                return;
            }
           
            // Create scheduled interview object
            scheduledInterview = {
                date: selectedDate,
                time: selectedTime,
                timestamp: new Date(`${selectedDate} ${selectedTime}`).getTime(),
                interviewLink: generateInterviewLink()
            };
           
            // Save scheduled interview to localStorage
            localStorage.setItem('scheduledInterview', JSON.stringify(scheduledInterview));
           
            // Show confirmation
            document.getElementById('scheduled-date-time').textContent =
                `${formatDate(selectedDate)} at ${selectedTime}`;
            confirmationSection.style.display = 'block';
           
            // Scroll to confirmation
            confirmationSection.scrollIntoView({ behavior: 'smooth' });
           
            // Send confirmation email
            sendConfirmationEmail();
           
            // Update link status
            checkInterviewLinkStatus();
            
            // Start checking link status continuously
            startLinkStatusChecker();
        }

        // Generate a unique interview link
        function generateInterviewLink() {
            const randomId = Math.random().toString(36).substring(2, 15);
            return `careercatalyst://interview/${randomId}`;
        }

        // Send confirmation email
        function sendConfirmationEmail() {
            // In a real application, you would send this email via an email service
            // For this demo, we'll simulate the email sending process
           
            const emailData = {
                to: currentUser.email,
                subject: 'CareerCatalyst Interview Scheduled',
                html: `
                    <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;">
                        <h2 style="color: #667eea; text-align: center;">CareerCatalyst Interview Confirmation</h2>
                        <p>Hello ${currentUser.username},</p>
                        <p>You have successfully scheduled your mock interview for <strong>${formatDate(selectedDate)} at ${selectedTime}</strong>.</p>
                        <p>Your unique interview link: <a href="${scheduledInterview.interviewLink}" style="color: #667eea;">${scheduledInterview.interviewLink}</a></p>
                        <p><strong>Important:</strong> This link will only be active 15 minutes before and after your scheduled interview time.</p>
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 5px; margin: 20px 0;">
                            <h3 style="color: #667eea; margin-top: 0;">Interview Preparation Tips:</h3>
                            <ul>
                                <li>Test your camera and microphone before the interview</li>
                                <li>Review the job description and your resume</li>
                                <li>Prepare questions to ask the interviewer</li>
                                <li>Find a quiet, well-lit space for the interview</li>
                            </ul>
                        </div>
                        <p>Best regards,<br><strong>The CareerCatalyst Team</strong></p>
                    </div>
                `
            };
           
            // Simulate API call to send email
            simulateEmailAPI(emailData)
                .then(response => {
                    showEmailNotification(
                        'Email Sent Successfully!',
                        `Confirmation email sent to ${currentUser.email}`,
                        true
                    );
                })
                .catch(error => {
                    showEmailNotification(
                        'Email Failed to Send',
                        'We could not send the confirmation email. Please check your internet connection.',
                        false
                    );
                });
        }

        // Simulate email API call
        function simulateEmailAPI(emailData) {
            return new Promise((resolve, reject) => {
                // Simulate network delay
                setTimeout(() => {
                    // In a real application, this would be an actual API call
                    // For demo purposes, we'll randomly succeed or fail
                    const success = Math.random() > 0.2; // 80% success rate
                   
                    if (success) {
                        resolve({
                            status: 200,
                            message: 'Email sent successfully'
                        });
                    } else {
                        reject({
                            status: 500,
                            message: 'Failed to send email'
                        });
                    }
                }, 2000);
            });
        }

        // Check if interview link is active
        function checkInterviewLinkStatus() {
            const savedInterview = localStorage.getItem('scheduledInterview');
            if (!savedInterview) {
                linkStatus.style.display = 'none';
                countdownTimer.style.display = 'none';
                return;
            }
           
            scheduledInterview = JSON.parse(savedInterview);
            const now = new Date().getTime();
            const interviewTime = scheduledInterview.timestamp;
            const bufferTime = 5 * 60 * 1000; // 5 minutes buffer
           
            linkStatus.style.display = 'block';
            countdownTimer.style.display = 'block';
           
            if (now >= interviewTime - bufferTime) {
                // Link is active (5 minutes before scheduled time)
                linkStatus.className = 'link-status active';
                linkStatusText.innerHTML = '<i class="fas fa-check-circle"></i> This interview link is now active';
                interviewLinkBtn.classList.remove('disabled');
                interviewLinkBtn.style.pointerEvents = 'auto';
                countdownTimer.textContent = 'Link is now active!';
            } else {
                // Link is not yet active
                linkStatus.className = 'link-status inactive';
                
                // Calculate time until activation
                const timeUntilActive = interviewTime - bufferTime - now;
                const hours = Math.floor(timeUntilActive / (1000 * 60 * 60));
                const minutes = Math.floor((timeUntilActive % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((timeUntilActive % (1000 * 60)) / 1000);
                
                linkStatusText.innerHTML = `<i class="fas fa-clock"></i> This interview link is not yet active`;
                countdownTimer.textContent = `Link activates in: ${hours}h ${minutes}m ${seconds}s`;
                interviewLinkBtn.classList.add('disabled');
                interviewLinkBtn.style.pointerEvents = 'none';
            }
        }

        // Continuously check interview link status
        function startLinkStatusChecker() {
            // Clear any existing interval
            if (linkStatusInterval) {
                clearInterval(linkStatusInterval);
            }
            
            // Check immediately
            checkInterviewLinkStatus();
            
            // Then check every second for real-time updates
            linkStatusInterval = setInterval(checkInterviewLinkStatus, 1000);
        }

        // Format date for display
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }

        // Start interview
        function startInterview() {
            // Check if interview link is active
            const savedInterview = localStorage.getItem('scheduledInterview');
            if (!savedInterview) {
                alert('No interview scheduled. Please schedule an interview first.');
                return;
            }
           
            scheduledInterview = JSON.parse(savedInterview);
            const now = new Date().getTime();
            const interviewTime = scheduledInterview.timestamp;
            const bufferTime = 5 * 60 * 1000; // 5 minutes buffer
           
            if (now >= interviewTime - bufferTime) {
                // Link is active, proceed to interview
                showInterview();
            } else {
                // Link is not yet active
                const timeUntilActive = interviewTime - bufferTime - now;
                const hours = Math.floor(timeUntilActive / (1000 * 60 * 60));
                const minutes = Math.floor((timeUntilActive % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((timeUntilActive % (1000 * 60)) / 1000);
                
                alert(`This interview link is not yet active.\n\nIt will become available in:\n${hours} hours, ${minutes} minutes, ${seconds} seconds\n\nPlease join at your scheduled time: ${formatDate(scheduledInterview.date)} at ${scheduledInterview.time}`);
            }
        }

        // Start interview timer
        function startInterviewTimer() {
            timerSeconds = 0;
            updateTimerDisplay();
           
            interviewTimer = setInterval(() => {
                timerSeconds++;
                updateTimerDisplay();
            }, 1000);
        }

        // Update timer display
        function updateTimerDisplay() {
            const hours = Math.floor(timerSeconds / 3600);
            const minutes = Math.floor((timerSeconds % 3600) / 60);
            const seconds = timerSeconds % 60;
           
            document.getElementById('interview-timer').textContent =
                `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        // Send chat message
        function sendMessage() {
            const message = chatInput.value.trim();
            if (message) {
                // Add user message to chat
                const messageElement = document.createElement('div');
                messageElement.className = 'message sent';
                messageElement.innerHTML = `<strong>You:</strong> ${message}`;
                chatMessages.appendChild(messageElement);
               
                // Clear input
                chatInput.value = '';
               
                // Scroll to bottom
                chatMessages.scrollTop = chatMessages.scrollHeight;
               
                // Evaluate answer and provide adaptive response
                const evaluation = evaluateAndRespond(message);
               
                // Add AI feedback after a short delay
                setTimeout(() => {
                    const feedbackElement = document.createElement('div');
                    feedbackElement.className = 'message received';
                    feedbackElement.innerHTML = `<strong>AI Interviewer:</strong> ${evaluation.feedback}`;
                    chatMessages.appendChild(feedbackElement);
                   
                    // Speak the feedback if AI voice is enabled
                    speakTextWithAvatar(evaluation.feedback);
                   
                    // Ask next question after feedback
                    setTimeout(() => {
                        askAdaptiveQuestion();
                    }, 2000);
                   
                    // Scroll to bottom
                    chatMessages.scrollTop = chatMessages.scrollHeight;
                }, 1000);
            }
        }

        // End interview
        function endInterview() {
            if (confirm('Are you sure you want to end the interview?')) {
                endInterviewCall();
                clearInterval(interviewTimer);
               
                // Stop voice recognition if active
                if (isListening) {
                    stopVoiceRecognition();
                }
               
                // Stop AI voice if active
                if (aiVoiceEnabled) {
                    window.speechSynthesis.cancel();
                }
               
                showDashboard();
            }
        }

        // Toggle microphone
        function toggleMic() {
            if (!localStream) {
                alert('Please start the call first');
                return;
            }
           
            const audioTracks = localStream.getAudioTracks();
            if (audioTracks.length > 0) {
                const audioTrack = audioTracks[0];
                audioTrack.enabled = !audioTrack.enabled;
               
                const micBtn = document.getElementById('mic-btn');
                if (audioTrack.enabled) {
                    micBtn.innerHTML = '<i class="fas fa-microphone"></i>';
                    micBtn.style.background = '';
                } else {
                    micBtn.innerHTML = '<i class="fas fa-microphone-slash"></i>';
                    micBtn.style.background = '#dc3545';
                }
            }
        }

        // Toggle camera
        function toggleCamera() {
            if (!localStream) {
                alert('Please start the call first');
                return;
            }
           
            const videoTracks = localStream.getVideoTracks();
            if (videoTracks.length > 0) {
                const videoTrack = videoTracks[0];
                videoTrack.enabled = !videoTrack.enabled;
               
                const cameraBtn = document.getElementById('camera-btn');
                if (videoTrack.enabled) {
                    cameraBtn.innerHTML = '<i class="fas fa-video"></i>';
                    cameraBtn.style.background = '';
                } else {
                    cameraBtn.innerHTML = '<i class="fas fa-video-slash"></i>';
                    cameraBtn.style.background = '#dc3545';
                }
            }
        }

        // WebRTC Functions
        async function startInterviewCall() {
            try {
                // Get camera and microphone access
                localStream = await navigator.mediaDevices.getUserMedia({
                    video: {
                        width: { ideal: 640 },
                        height: { ideal: 480 }
                    },
                    audio: {
                        echoCancellation: true,
                        noiseSuppression: true
                    }
                });
               
                // Display local video
                const localVideo = document.getElementById('localVideo');
                localVideo.srcObject = localStream;
               
                // Update button state
                document.getElementById('start-call-btn').classList.add('active');
                document.getElementById('start-call-btn').innerHTML = '<i class="fas fa-check"></i>';
               
                alert('Video call started! Camera and microphone are now active.');
               
            } catch (error) {
                console.error('Error starting call:', error);
                alert('Error accessing camera/microphone: ' + error.message);
            }
        }

        function endInterviewCall() {
            if (localStream) {
                localStream.getTracks().forEach(track => {
                    track.stop();
                });
                localStream = null;
            }
           
            const localVideo = document.getElementById('localVideo');
            if (localVideo) localVideo.srcObject = null;
           
            // Update button state
            document.getElementById('start-call-btn').classList.remove('active');
            document.getElementById('start-call-btn').innerHTML = '<i class="fas fa-play"></i>';
        }

        // Initialize the application when the page loads
        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>